<!DOCTYPE html>
<html><head>
<title>VBA 提取数据</title>

<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">

<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-160166122-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>




<link rel="stylesheet" href="https://pozhuzi.github.io/scss/journal.min.0422b492afcf0079d0ce61a832e8a5d2dc3b23ebb111e1a64c61a8015f3cb933.css" integrity="sha256-BCK0kq/PAHnQzmGoMuil0tw7I&#43;uxEeGmTGGoAV88uTM=" media="screen">

<script src="https://pozhuzi.github.io/js/loadCSS.js"></script>
<script src="https://pozhuzi.github.io/js/table.js"></script>


<script src="https://pozhuzi.github.io/js/toc.js"></script>


<script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
  clientID: '155dd30feea0c4ff9c79',
  clientSecret: '86a9adb1c90dd6901752af7e47b294f11e0ba54b',
  repo: 'blog-comments',
  owner: 'pozhuzi',
  admin: ['pozhuzi'],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>






</head><body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://pozhuzi.github.io">
    
        <div class="nav-title">
            空山新雨后
        </div>
        
        <div class="nav-subtitle">
            Learn for Life
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
                
                
                <a class="a-block nav-link-item false" href="/posts/">
                    归档
                </a>
        
            
                
                
                <a class="a-block nav-link-item false" href="/categories/">
                    分类
                </a>
        
            
                
                
                <a class="a-block nav-link-item false" href="/tags/">
                    标签
                </a>
        
            
                
                
                <a class="a-block nav-link-item false" href="/about/">
                    关于
                </a>
        
            
                
                
                <a class="a-block nav-link-item false" href="/index.xml">
                    RSS
                </a>
        
    </div>

    

    <div class="nav-footer">
        Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>
&copy;
	
	2020 Pozhuzi. All rights reserved.
	
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e8%83%8c%e6%99%af" v-on:click="closeDrawer" id="背景-nav">
										 背景
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%af%b9%e8%b1%a1%e8%af%b4%e6%98%8e" v-on:click="closeDrawer" id="对象说明-nav">
										 对象说明
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e8%a7%a3%e5%86%b3%e6%ad%a5%e9%aa%a4" v-on:click="closeDrawer" id="解决步骤-nav">
										 解决步骤
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%80%bb%e7%bb%93" v-on:click="closeDrawer" id="总结-nav">
										 总结
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%9b%b4%e6%96%b0%e8%ae%b0%e5%bd%95" v-on:click="closeDrawer" id="更新记录-nav">
										 更新记录
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
    </div>
</div><div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
                
                    
                    
                    <a class="a-block drawer-menu-item false" href="/posts/">
                        归档
                    </a>
            
                
                    
                    
                    <a class="a-block drawer-menu-item false" href="/categories/">
                        分类
                    </a>
            
                
                    
                    
                    <a class="a-block drawer-menu-item false" href="/tags/">
                        标签
                    </a>
            
                
                    
                    
                    <a class="a-block drawer-menu-item false" href="/about/">
                        关于
                    </a>
            
                
                    
                    
                    <a class="a-block drawer-menu-item false" href="/index.xml">
                        RSS
                    </a>
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e8%83%8c%e6%99%af" v-on:click="closeDrawer" id="背景-nav">
										 背景
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%af%b9%e8%b1%a1%e8%af%b4%e6%98%8e" v-on:click="closeDrawer" id="对象说明-nav">
										 对象说明
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e8%a7%a3%e5%86%b3%e6%ad%a5%e9%aa%a4" v-on:click="closeDrawer" id="解决步骤-nav">
										 解决步骤
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%80%bb%e7%bb%93" v-on:click="closeDrawer" id="总结-nav">
										 总结
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%9b%b4%e6%96%b0%e8%ae%b0%e5%bd%95" v-on:click="closeDrawer" id="更新记录-nav">
										 更新记录
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://pozhuzi.github.io">
            空山新雨后
        </a>
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://pozhuzi.github.io">
        <div class="single-column-header-title">空山新雨后</div>
        
        <div class="single-column-header-subtitle">Learn for Life</div>
        

    </a>
</div>
            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                 style="background-image: url('/')">
                
                <img src="https://pozhuzi.github.io" style="display: none;"></img>
                <div class="post-title">
                    VBA 提取数据
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2020-09-06 00:27
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/%E5%B7%A5%E5%85%B7">工具</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/vba">VBA</a>
                                &nbsp;
                            
                        
                        <span class="post-word-count">  1056 words</span>

                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                <div class="post-body">
                    <h3 id="背景">背景</h3>
<p>工作上有一项内容是将G表格中的参数填写到X表格中，有时一走神就容易出错。于是就想用VBA一键提取，省的一个一个数字去复制。</p>
<h3 id="对象说明">对象说明</h3>
<ol>
<li>G表格和X表格相似，G与X的格式都是固定的</li>
<li>X表格是一个模板，若选择G1，则提取G1的参数，若选择G2，则提取G2的参数</li>
<li>G表格的子页数不固定</li>
</ol>
<h3 id="解决步骤">解决步骤</h3>
<ol>
<li>选择G表格（这一步直接利用之前做相同需求的代码）。</li>
</ol>
<pre tabindex="0"><code>Option Compare Text '不区分大小写比较文本
Option Explicit
Sub 按钮1_Click()
Application.ScreenUpdating = False   '关闭屏幕刷新Dim filepath As String
With Application.FileDialog(msoFileDialogFilePicker)'开启选择窗口
  .Title = &quot;请选择相应的工艺卡&quot;
  .AllowMultiSelect = False '只允许选择单一文件
  .InitialFileName = ThisWorkbook.Path '默认打开路径为本工作簿的路径
  .Filters.Clear '清除现有的文件类型
  .Filters.Add &quot;Excel&quot;, &quot;*.xls, *.xlsx&quot;, 1 '添加选择文件类型
  .FilterIndex = 1
  If .Show = -1 Then '判定有无选择文件
    filepath = .SelectedItems(1)
    MsgBox &quot;选择了：&quot; &amp; .SelectedItems(1), vbInformation
  Else
    MsgBox &quot;未选择任何文件，请重新选择！&quot;, vbExclamation
    Exit Sub
  End If
End With
</code></pre><ol start="2">
<li>将G表格中子页的参数填到X表格的子页中：
尝试过使用固定位置一一对应填进去，但是显得很臃肿，而且一但G表格的参数位置稍微一变化就会出错。所以利用G表格中的参数名称锁定参数，会比较灵活一点。</li>
</ol>
<pre tabindex="0"><code>Dim ProcessCard As Workbook
Dim Process As Worksheet
Dim ProItem As Range
Dim Protext As String

Dim ZhiCheng(5) As String '定义制程（G与X表格的子页名称）的数组
ZhiCheng(0) = &quot;BM&quot;
ZhiCheng(1) = &quot;R&quot;
ZhiCheng(2) = &quot;G&quot;
ZhiCheng(3) = &quot;B&quot;
ZhiCheng(4) = &quot;OC&quot;
ZhiCheng(5) = &quot;PS&quot;
Dim A As Variant
Dim B As String
Set ProcessCard = GetObject(filepath)
Dim testcount As Integer
testcount = 0

For Each Process In ProcessCard.Worksheets '对G子页进行循环
  For Each A In ZhiCheng '对数组进行循环'
    If InStr(Process.Name, A) Then '若G与数组中的元素对应，开始提取
      ThisWorkbook.Sheets(A).Range(&quot;C5:D5,C6:C7,D8,F8,G8,K8,L8,M8,N8,O8,P8&quot;) = &quot;&quot; '初始化置空
      For Each ProItem In Process.Range(&quot;A1&quot;, &quot;A70&quot;) '在各页的第一页寻找参数名称
        Protext = Trim(ProItem.Text) '去掉字符前后的空格
        
        Select Case ProItem.Text
        Case &quot;适用产品&quot;
        ThisWorkbook.Sheets(A).Range(&quot;C5&quot;) = ProItem.Offset(0, 1).Text  '直接复制粘贴参数
    
        Case &quot;Coating 速度&quot;
        B = ProItem.Offset(0, 1).Text
        B = Replace(B, &quot;mm/s&quot;, &quot;&quot;)
        ThisWorkbook.Sheets(A).Range(&quot;F8&quot;) = B '替换掉参数里面的单位
    
        Case &quot;COT Dispense Speed&quot;
        B = ProItem.Offset(0, 1).Text
        B = Left(B, 4)
        ThisWorkbook.Sheets(A).Range(&quot;G8&quot;) = B'只选择参数的前四位（容易出bug)
        
        End Select
      Next
    End If
  Next
Next

'判断参数是否为空
For Each A In ZhiCheng '对制程进行循环
 If ThisWorkbook.Sheets(A).Range(&quot;C5&quot;) = &quot;&quot; Then '如果为空则提示
testcount = testcount + 1
MsgBox &quot;sheet &quot; &amp; A &amp; &quot; C5 为空，请检查工艺卡格式&quot; &amp; Chr(13) &amp; &quot;或手动填入参数&quot;
End If
Next
If testcount = 0 Then
MsgBox &quot;提取成功！&quot;
End If

GetObject(filepath).Close '关闭打开的工作簿
</code></pre><h3 id="总结">总结</h3>
<p>利用循环解决了位置不固定的问题，其中比较麻烦的是对参数的处理，有的是直接复制，有的是替换单位，有的无法识别单位符号的就选用前四位。</p>
<h3 id="更新记录">更新记录</h3>
<ul>
<li>v1.1 添加初始化置空，避免未能提取参数的情况下保存上次记录，造成误会。</li>
<li>v1.2 加入判断函数（是否全部提取成功），使用Compare Text声明及Trim函数。</li>
</ul>

                    
                    <HR width="100%" id="EOF">
                    <p style="color:#777;">Last modified on 2020-09-06</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://pozhuzi.github.io/about/">
                    Next<br>自我介绍
                </a>
                
                
                
                <a class="older-posts" href="https://pozhuzi.github.io/2020/20200408-xiaoheshuangpin/">
                    Previous<br>微软拼音配置小鹤双拼
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>





            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>
&copy;
	
	2020 Pozhuzi. All rights reserved.
	</div>
    	</div>
    <script src="https://pozhuzi.github.io/js/journal.js"></script>
    </body>
</html>
